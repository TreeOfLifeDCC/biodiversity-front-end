<div class="vf-u-margin__top--800" style="margin: 0 10% 10%">


    <div class="vf-content vf-u-grid__col--span-1">

        <div>
            <mat-card>
                <mat-card-title
                        style="text-align: center"><label class="vf-page-header__heading">
                    <h1>{{ organismData?.organism }}</h1></label></mat-card-title>
                <mat-card-actions>
                    <dl>
                        @if (organismData?.commonName) {
                            <dt><h4>Common name:</h4>
                            <dd>{{ organismData?.commonName }}</dd>
                        }
                        @if (organismData?.tolid) {
                            <dt><h4>ToL ID:</h4></dt>
                            <dd>{{ typeofTol(organismData?.tolid) }}</dd>
                        }
                        @if (organismData?.sex) {
                            <dt><h4>Sex:</h4></dt>
                            <dd>{{ organismData?.sex }}</dd>
                        }
                    </dl>
                </mat-card-actions>
            </mat-card>
            <br>
            <mat-tab-group dynamicHeight #tabgroup>
                <mat-tab label="Metadata" style="width:100%">
                    <hr>
                    <h2>Related Organisms</h2>
                    @if (isLoadingResults || isRateLimitReached) {
                        <div>
                            @if (isLoadingResults) {
                                <mat-spinner></mat-spinner>
                            }
                            @if (isRateLimitReached) {
                                <div>
                                    Something went wrong, please try again!
                                </div>
                            }
                        </div>
                    }

                    <div class="vf-form__item | vf-search__item">
                        <input type="search" id="searchValue" matInput style="
    width: 99%;" name="searchValue"
                               class="vf-search__input | vf-form__input"
                               (keyup)="getSearchResults('metadata')"
                               placeholder="Ex. Mia" #input>

                    </div>

                    <div style="float: right;font-size: 14px; font-weight: 400;">

                        <button style="float: left;margin-top: 10px;" type="submit"
                                class="vf-button vf-button--primary vf-button--outline vf-button--sm"
                                (click)="exporter.exportTable('csv', {fileName: 'related_organisms'})">Download metadata
                        </button>
                    </div>

                    <br>
                    <div>
                        @if (metadataSexFilters.length) {
                            <div class="col-md-12 col-md-6">
                                <div class="card bg-lite mb-3 filter-top">
                                    <h3 class="card-header filter-heading">
                                        <span #lbltextSex>Sex</span>
                                        @if (metadataSexFilters.length > 3) {
                                            <i class="material-icons float-right pointer-cursor"
                                               (click)="toggleFilter('metadataTab',
                                                               'sex')">
                                                {{ showAllFilters['metadataTab']['sex'] ? 'remove' : 'add' }}
                                            </i>
                                        }
                                    </h3>

                                    <ul class="list-group">
                                        @for (filter of (showAllFilters['metadataTab']['sex'] ? metadataSexFilters : metadataSexFilters.slice(0, 3)); track $index ) {
                                            @if (filter.key != '') {
                                                <li id="{{$index}}"
                                                    class="list-group-item d-flex justify-content-between align-items-center"
                                                    [ngClass]="checkFilterIsActive(filter.key)"
                                                    (click)="applyFilter('sex', filter.key, metadataData, 'metadataTab')"
                                                    style="cursor: pointer; padding: .75rem 0.25rem;">
                                                    {{ filter.key }}
                                                    <span class="badge badge-pill badge-info">{{ filter.doc_count }}</span>
                                                </li>
                                            }

                                        }

                                    </ul>
                                </div>
                            </div>
                        }

                        @if (metadataOrganismPartFilters.length) {
                            <div class="col-md-12 col-md-6">
                                <div class="card bg-lite mb-3 filter-top">
                                    <h3 class="card-header filter-heading">
                                        <span #lbltextOrgPart>Organism Part</span>
                                        @if (metadataOrganismPartFilters.length > 3) {
                                            <i class="material-icons float-right pointer-cursor"
                                               (click)="toggleFilter('metadataTab',
                                                               'organismPart')">
                                                {{ showAllFilters['metadataTab']['organismPart'] ? 'remove' : 'add' }}
                                            </i>
                                        }
                                    </h3>

                                    <ul class="list-group">
                                        @for (filter of (showAllFilters['metadataTab']['organismPart'] ? metadataOrganismPartFilters : metadataOrganismPartFilters.slice(0, 3)); track $index ) {
                                            @if (filter.key != '') {
                                                <li id="{{$index}}"
                                                    class="list-group-item d-flex justify-content-between align-items-center"
                                                    [ngClass]="checkFilterIsActive(filter.key)"
                                                    (click)="applyFilter('organismPart', filter.key, metadataData,'metadataTab')"
                                                    style="cursor: pointer; padding: .75rem 0.25rem;">
                                                    {{ filter.key }}
                                                    <span class="badge badge-pill badge-info">{{ filter.doc_count }}</span>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </div>
                            </div>
                        }

                        @if (metadataTrackingSystemFilters.length) {
                            <div class="col-md-12 col-md-6">
                                <div class="card bg-lite mb-3 filter-top">
                                    <h3 class="card-header filter-heading">
                                        <span #lbltextTrack>Tracking Status</span>
                                        @if (metadataTrackingSystemFilters.length > 3) {
                                            <i class="material-icons float-right pointer-cursor"
                                               (click)="toggleFilter('metadataTab',
                                                               'trackingSystem')">
                                                {{ showAllFilters['metadataTab']['trackingSystem'] ? 'remove' : 'add' }}
                                            </i>
                                        }
                                    </h3>

                                    <ul class="list-group">
                                        @for (filter of (showAllFilters['metadataTab']['trackingSystem'] ? metadataTrackingSystemFilters : metadataTrackingSystemFilters.slice(0, 3)); track $index ) {
                                            @if (filter.key != '') {
                                                <li id="{{$index}}"
                                                    class="list-group-item d-flex justify-content-between align-items-center"
                                                    [ngClass]="checkFilterIsActive(filter.key)"
                                                    (click)="applyFilter('trackingSystem',filter.key, metadataData,'metadataTab')"
                                                    style="cursor: pointer; padding: .75rem 0.25rem;">
                                                    {{ filter.key }}
                                                    <span class="badge badge-pill badge-info">{{ filter.doc_count }}</span>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </div>
                            </div>
                        }

                    </div>
                    <br>

                    <table mat-table [dataSource]="metadataData" matSort #metadataSort="matSort"
                           matTableExporter #exporter="matTableExporter">

                        <ng-container matColumnDef="accession">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Accession</th>
                            <td mat-cell *matCellDef="let row">
                                <a mat-button [routerLink]="['/organism', row.accession]">{{ row.accession }}</a>
                                @if(row.nagoya_protocol && row.nagoya_protocol === true) {
                                    <mat-chip
                                            style="margin-bottom: 5px; background-color: yellow; color: black">
                                        <a mat-button
                                           href="https://drive.google.com/file/d/1tkTdo-dI30YFokE2YpwmzP9onhrrEyhD/view?usp=drive_link">
                                            Ethics and law</a>
                                    </mat-chip>
                                }
                            </td>
                        </ng-container>

                        <!-- Progress Column -->
                        <ng-container matColumnDef="organism">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Organism</th>
                            <td mat-cell *matCellDef="let row"> {{ row.organism.text }}</td>
                        </ng-container>

                        <!-- Name Column -->
                        <ng-container matColumnDef="commonName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Common Name</th>
                            <td mat-cell *matCellDef="let row"> {{ row.commonName }}</td>
                        </ng-container>

                        <!-- Fruit Column -->
                        <ng-container matColumnDef="sex">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Sex</th>
                            <td mat-cell *matCellDef="let row"> {{ row.sex }}</td>
                        </ng-container>

                        <ng-container matColumnDef="organismPart">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Organism Part</th>
                            <td mat-cell *matCellDef="let row"> {{ row.organismPart }}</td>
                        </ng-container>

                        <ng-container matColumnDef="trackingSystem" style="min-width: 320px;">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header style="min-width: 320px;"> Status</th>
                            <td mat-cell *matCellDef="let row">
                                <mat-chip selected [style]="getStyle(row.trackingSystem)">
                                    {{ row.trackingSystem }}
                                </mat-chip>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="metadataDisplayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: metadataDisplayedColumns;"></tr>
                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="4">No data matching the filter "{{ input.value }}"</td>
                        </tr>
                    </table>

                    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page of metadata Data"
                                   #metadataPaginator [length]="metadataDataLength"></mat-paginator>


                </mat-tab>
                @if (annotationDataLength !== 0 || assembliesDataLength !== 0 || filesDataLength !== 0) {
                    <mat-tab label="Data"
                             style=" white-space: nowrap; cursor: pointer;">
                        <hr>
                        @if (isLoadingResults || isRateLimitReached) {
                            <div
                            >
                                @if (isLoadingResults) {
                                    <mat-spinner></mat-spinner>
                                }
                                @if (isRateLimitReached) {
                                    <div>
                                        Something went wrong, please try again!
                                    </div>
                                }
                            </div>
                        }
                        <br>
                        @if (annotationDataLength !== 0) {
                            <h2>Annotation</h2>
                            <div class="vf-form__item | vf-search__item">
                                <input type="search" matInput style="
                         width: 99%;" name="searchValue" class="vf-search__input | vf-form__input"
                                       (keyup)="getSearchResults('annotation')" placeholder="Illumina" #input>
                            </div>
                            <div style="float: right;font-size: 14px; font-weight: 400;">
                                <button style="float: left;margin-top: 10px;" type="submit"
                                        class="vf-button vf-button--primary vf-button--outline vf-button--sm"
                                        (click)="annotationExporter.exportTable('csv', {fileName: 'related_annotations'})">
                                    Download metadata
                                </button>
                            </div>
                            <table mat-table [dataSource]="annotationData" matSort #annotationSort="matSort"
                                   matTableExporter
                                   #annotationExporter="matTableExporter"
                            >
                                <ng-container matColumnDef="species">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Species</th>
                                    <td mat-cell *matCellDef="let row"> {{ row.species }}</td>
                                </ng-container>
                                <ng-container matColumnDef="accession">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Accession</th>
                                    <td mat-cell *matCellDef="let row"> {{ row.accession }}</td>
                                </ng-container>
                                <ng-container matColumnDef="annotation_gtf">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Annotation GTF</th>
                                    <td mat-cell *matCellDef="let row">
                                        <a mat-button href="{{row['annotation']['GTF']}}">GTF</a>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="annotation_gff3">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> annotation GTF3</th>
                                    <td mat-cell *matCellDef="let row">
                                        <a mat-button href="{{row.annotation.GFF3}}">GFF3</a>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="proteins">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Proteins FASTA</th>
                                    <td mat-cell *matCellDef="let row">
                                        <a mat-button href="{{row.proteins.FASTA}}">FASTA</a>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="transcripts">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Transcripts FASTA</th>
                                    <td mat-cell *matCellDef="let row">
                                        <a mat-button href="{{row.transcripts.FASTA}}">FASTA</a>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="softmasked_genome">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Softmasked Genome FASTA</th>
                                    <td mat-cell *matCellDef="let row">
                                        <a mat-button href="{{row.softmasked_genome.FASTA}}">FASTA</a>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="repeat_library">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Repeat Library FASTA</th>
                                    <td mat-cell *matCellDef="let row">
                                        FASTA
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="other_data">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Other Data FTP Dumps</th>
                                    <td mat-cell *matCellDef="let row">
                                        <a mat-button href="{{row.other_data.ftp_dumps}}">FTP Dumps</a>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="view_in_browser">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> View in Browser</th>
                                    <td mat-cell *matCellDef="let row">
                                        <a mat-button href="{{row.view_in_browser}}">Ensembl</a>
                                    </td>
                                </ng-container>
                                <tr mat-header-row *matHeaderRowDef="annotationsDisplayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: annotationsDisplayedColumns;"></tr>
                                <tr class="mat-row" *matNoDataRow>
                                    <td class="mat-cell" colspan="4">No data matching the filter "{{ input.value }}"
                                    </td>
                                </tr>
                            </table>
                            <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"
                                           aria-label="Select page of annotations"
                                           #annotationPaginator
                                           [length]="annotationDataLength">
                            </mat-paginator>
                        }
                        <br>
                        @if (assembliesDataLength !== 0) {
                            <h2>Related Assemblies</h2>
                            <div class="vf-form__item | vf-search__item">
                                <input type="search" matInput style="
                         width: 99%;" name="searchValue" class="vf-search__input | vf-form__input"
                                       (keyup)="getSearchResults('assemblies')" placeholder="Illumina" #input>
                            </div>
                            <div style="float: right;font-size: 14px; font-weight: 400;">
                                <button style="float: left;margin-top: 10px;" type="submit"
                                        class="vf-button vf-button--primary vf-button--outline vf-button--sm"
                                        (click)="assembliesExporter.exportTable('csv', {fileName: 'related_assemblies'})">
                                    Download metadata
                                </button>
                            </div>
                            <table mat-table [dataSource]="assembliesData" matSort #assembliesSort="matSort"
                                   matTableExporter
                                   #assembliesExporter="matTableExporter">
                                <!-- ID Column -->
                                <ng-container matColumnDef="accession">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Accession</th>
                                    <td mat-cell *matCellDef="let row">
                                        <a mat-button href="https://www.ebi.ac.uk/ena/browser/view/{{row.accession}}">
                                            {{ row.accession }}</a>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="version">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Version</th>
                                    <td mat-cell *matCellDef="let row"> {{ row.version }}</td>
                                </ng-container>
                                <ng-container matColumnDef="assembly_name">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Assembly Name</th>
                                    <!--            <td mat-cell *matCellDef="let row"> {{row.annotation.GTF}} </td>-->
                                    <td mat-cell *matCellDef="let row">{{ row.assembly_name }}</td>
                                </ng-container>
                                <ng-container matColumnDef="description" style="min-width: 560px;">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="min-width: 631px;">
                                        Description
                                    </th>
                                    <td mat-cell *matCellDef="let row">{{ row.description }}</td>
                                </ng-container>
                                <tr mat-header-row *matHeaderRowDef="assembliesDisplayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: assembliesDisplayedColumns;"></tr>
                                <tr class="mat-row" *matNoDataRow>
                                    <td class="mat-cell" colspan="4">No data matching the filter "{{ input.value }}"
                                    </td>
                                </tr>
                            </table>
                            <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"
                                           aria-label="Select page of assemblies"
                                           #assembliesPaginator
                                           [length]="assembliesDataLength">
                            </mat-paginator>
                        }
                        <br>
                        @if (filesDataLength !== 0) {
                            <h2>Related Files</h2>
                            <div class="vf-form__item | vf-search__item">
                                <input type="search" matInput style="
                         width: 99%;" name="searchValue" class="vf-search__input | vf-form__input"
                                       (keyup)="getSearchResults('files')" placeholder="Illumina" #input>
                            </div>
                            <div style="float: right;font-size: 14px; font-weight: 400;">
                                <button style="float: left;margin-top: 10px;" type="submit"
                                        class="vf-button vf-button--primary vf-button--outline vf-button--sm"
                                        (click)="filesExporter.exportTable('csv', {fileName: 'related_files'})">Download
                                    metadata
                                </button>
                            </div>
                            <table mat-table [dataSource]="filesData" matSort #filesSort="matSort" matTableExporter
                                   style="overflow: auto hidden; min-width: 100% ; "
                                   #filesExporter="matTableExporter">
                                @for (column of filesDisplayedColumns; track column) {
                                    <ng-container [matColumnDef]="column">
                                        <th mat-header-cell *matHeaderCellDef
                                            mat-sort-header> {{ getHumanReadableName(column) }}
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            @if (column === 'study_accession') {
                                                <a mat-button
                                                   href="{{getStudyLink(element[column])}}">{{ element[column] }}</a>
                                            }
                                            @if (keyInSpecialColumns(column)) {
                                                <a mat-button
                                                   href="{{element.column}}">{{ getKeyFromSpecialColumns(element[column]) }}</a>
                                            }
                                            @if (!keyInSpecialColumns(column) && column !== 'study_accession') {
                                                {{ element[column] }}
                                            }
                                        </td>
                                    </ng-container>
                                }
                                <tr mat-header-row *matHeaderRowDef="filesDisplayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: filesDisplayedColumns;"></tr>
                                <tr class="mat-row" *matNoDataRow>
                                    <td class="mat-cell" colspan="4">No data matching the filter "{{ input.value }}"
                                    </td>
                                </tr>
                            </table>
                            <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page of files"
                                           #filesPaginator [length]="filesDataLength"></mat-paginator>
                        }
                    </mat-tab>
                }

                 @if(showGenomeNote){
                    <mat-tab label="Publications">
                        <!-- Genome Notes Section -->
                        <div class="goat-box">
                            <hr>
                            <mat-expansion-panel [expanded]="true">
                                <mat-expansion-panel-header class="page-header">
                                    <h3>Published Genome Note</h3>
                                </mat-expansion-panel-header>
                                @for(gen of organismData?.genome_notes; track $index){
                                    <div class="genome-card">
                                        <h3 class="title" [innerHTML]="sanitizeHTML(gen.title)"></h3>
                                        <div class="content">
                                            <img class="image" src="{{gen.figureURI}}" alt="Genome Image" (click)="openPopup(gen.figureURI)">
                                            <div class="text">
                                                <p>{{gen.abstract}}</p>
                                                <a href="{{gen.url}}" class="read-btn" target="_blank">Read the Genome Note in full</a>
                                            </div>
                                        </div>
                                        <p class="caption">{{gen.caption}}</p>
                                        <p class="cite">{{gen.citeURL}}</p>
                                    </div>
                                }
                            </mat-expansion-panel>
                        </div>

                        <!-- popup Modal -->
                        @if(popupImage) {
                            <div class="popup-overlay" (click)="closePopup()">
                                <div class="popup-content">
                                    <img [src]="popupImage" class="popup-image">
                                </div>
                            </div>
                        }
                    </mat-tab>
                }

                @if (goatDataLength !== 0) {
                    <mat-tab label="Genome Stats (GoaT)">
                        <br>
                        @if(organismData?.goat_info?.attributes.length){
                            <mat-expansion-panel [expanded]="true" >
                            <mat-expansion-panel-header class="page-header">
                                <h3>Goat Info</h3>
                            </mat-expansion-panel-header>
                        <table mat-table [dataSource]="goatData" matTableExporter>
                            <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef> Attribue</th>
                                <td mat-cell *matCellDef="let row"> {{ row.name }}</td>
                            </ng-container>
                            <ng-container matColumnDef="value">
                                <th mat-header-cell *matHeaderCellDef> Value</th>
                                <td mat-cell *matCellDef="let row"> {{ row.value }}</td>
                            </ng-container>
                            <ng-container matColumnDef="count">
                                <th mat-header-cell *matHeaderCellDef> Count</th>
                                <td mat-cell *matCellDef="let row">{{ row.count }}</td>
                            </ng-container>
                            <ng-container matColumnDef="aggregation_method">
                                <th mat-header-cell *matHeaderCellDef> Aggregation Method</th>
                                <td mat-cell *matCellDef="let row">{{ row.aggregation_method }}</td>
                            </ng-container>
                            <ng-container matColumnDef="aggregation_source"
                                          class="column-width-aggregation">
                                <th mat-header-cell *matHeaderCellDef
                                    class="column-width-aggregation"> Aggregation
                                    Source
                                </th>
                                <td mat-cell *matCellDef="let row">{{ row.aggregation_source }}</td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="goatDisplayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: goatDisplayedColumns;"></tr>
                            <tr class="mat-row" *matNoDataRow>
                                <td class="mat-cell" colspan="4">No data matching the filter "{{ input.value }}"</td>
                            </tr>
                        </table>
                        <a mat-button href="{{goatDataLink}}"
                           style="background-color: limegreen; color: black; margin-top: 5px">
                            Read the GoaT info in full here</a>
                        </mat-expansion-panel>
                        }
                    </mat-tab>
                }

                <!-- Geo Location Map -->
                @if (geoLocation) {
                    <mat-tab label="Geo Location Maps">
                        <ng-container *ngTemplateOutlet="mapTemplate; context: { orgGeoList: orgGeoList, specGeoList: specGeoList }"></ng-container>

                        <ng-template #mapTemplate let-orgGeoList="orgGeoList" let-specGeoList="specGeoList">
                            <mat-tab-group>
                                <mat-tab label="Sampling Map">
                                    <!-- Geo Section -->
                                    <hr>
                                    <div class="center-align">
                                        <app-map-cluster [orgGeoList]="orgGeoList"
                                                         [specGeoList]="specGeoList"></app-map-cluster>
                                    </div>
                                    <hr>
                                </mat-tab>

                                @if (nbnatlas) {
                                    <mat-tab label="Occurrences Map">
                                        <hr>
                                        <a style="margin-left: 330px;" href="{{nbnatlasMapUrl}}" class="btn" target="_blank">Open interactive map in new window</a>

                                        <div class="col-md-12" style=" display: block; margin-left: 100px; margin-right: auto;">
                                            @if (isLoading) {
                                                <div [ngStyle]="{height:height+'px',width:width+'px'}" class="loading" >
                                                    <img style="margin-left: 280px;" [src]="loader" />
                                                </div>
                                            }
                                            @if (url) {
                                                <div class="center-align">
                                                    <div class="image-nbnatlas">
                                                        <img  [src]='url' (load)="hideLoader()">
                                                    </div>
                                                    The National Biodiversity Network records are shown on the map above
                                                    (See <a href="https://nbnatlas.org/help/nbn-atlas-terms-use/"
                                                            target="_blank">terms and conditions</a>) .
                                                    <a href="https://nbnatlas.org/" target="_blank">
                                                        <img src="assets/NBNPower.gif">
                                                    </a>
                                                </div>
                                            }
                                        </div>
                                        <hr>
                                    </mat-tab>
                                }
                            </mat-tab-group>
                        </ng-template>
                    </mat-tab>
                }

                @if (organismData?.symbionts_records && organismData?.symbionts_records.length) {
                    <mat-tab label="Symbionts"
                             class=tab-width>
                        @if (organismData?.symbionts_records.length) {
                            <div>
                                <hr>
                                <h1 class="page-header">Related Symbionts</h1>
                                <div class="row">
                                    @if (symbiontsSexFilters.length) {
                                        <div class="col-md-12 col-md-6">
                                            <div class="card bg-lite mb-3 filter-top">
                                                <h3 class="card-header filter-heading">
                                                    <span #lbltextSex>Sex</span>
                                                    @if (symbiontsSexFilters.length > 3) {
                                                        <i class="material-icons float-right pointer-cursor"
                                                           (click)="toggleFilter('symbiontsTab',
                                                               'sex')">
                                                            {{ showAllFilters['symbiontsTab']['sex'] ? 'remove' : 'add' }}
                                                        </i>
                                                    }
                                                </h3>

                                                <ul class="list-group">
                                                    @for (filter of (showAllFilters['symbiontsTab']['sex'] ? symbiontsSexFilters : symbiontsSexFilters.slice(0, 3)); track $index ) {
                                                        @if (filter.key != '') {
                                                            <li id="{{$index}}"
                                                                class="list-group-item d-flex justify-content-between align-items-center"
                                                                [ngClass]="checkFilterIsActive(filter.key)"
                                                                (click)="applyFilter('sex', filter.key, dataSourceSymbiontsRecords, 'symbiontsTab')"
                                                                style="cursor: pointer; padding: .75rem 0.25rem;"
                                                            >
                                                                {{ filter.key }}
                                                                <span class="badge badge-pill badge-info">{{ filter.doc_count }}</span>
                                                            </li>
                                                        }

                                                    }

                                                </ul>
                                            </div>
                                        </div>
                                    }

                                    @if (symbiontsOrganismPartFilters.length) {
                                        <div class="col-md-12 col-md-6">
                                            <div class="card bg-lite mb-3 filter-top">
                                                <h3 class="card-header filter-heading">
                                                    <span #lbltextOrgPart>Organism Part</span>
                                                    @if (symbiontsOrganismPartFilters.length > 3) {
                                                        <i class="material-icons float-right pointer-cursor"
                                                           (click)="toggleFilter('symbiontsTab',
                                                               'organismPart')">
                                                            {{ showAllFilters['symbiontsTab']['organismPart'] ? 'remove' : 'add' }}
                                                        </i>
                                                    }
                                                </h3>

                                                <ul class="list-group">

                                                    @for (filter of (showAllFilters['symbiontsTab']['organismPart'] ? symbiontsOrganismPartFilters : symbiontsOrganismPartFilters.slice(0, 3)); track $index ) {
                                                        @if (filter.key != '') {
                                                            <li id="{{$index}}"
                                                                class="list-group-item d-flex justify-content-between align-items-center"
                                                                [ngClass]="checkFilterIsActive(filter.key)"
                                                                (click)="applyFilter('organismPart', filter.key, dataSourceSymbiontsRecords,'symbiontsTab')"
                                                                style="cursor: pointer; padding: .75rem 0.25rem;">
                                                                {{ filter.key }}
                                                                <span class="badge badge-pill badge-info">{{ filter.doc_count }}</span>
                                                            </li>
                                                        }
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    }

                                    @if (symbiontsTrackingSystemFilters.length) {
                                        <div class="col-md-12 col-md-6">
                                            <div class="card bg-lite mb-3 filter-top">
                                                <h3 class="card-header filter-heading">
                                                    <span #lbltextTrack>Tracking Status</span>
                                                    @if (symbiontsTrackingSystemFilters.length > 3) {
                                                        <i class="material-icons float-right pointer-cursor"
                                                           (click)="toggleFilter('symbiontsTab',
                                                               'trackingSystem')">
                                                            {{ showAllFilters['symbiontsTab']['trackingSystem'] ? 'remove' : 'add' }}
                                                        </i>
                                                    }
                                                </h3>

                                                <ul class="list-group">
                                                    @for (filter of (showAllFilters['symbiontsTab']['trackingSystem'] ? symbiontsTrackingSystemFilters : symbiontsTrackingSystemFilters.slice(0, 3)); track $index ) {
                                                        @if (filter.key != '') {
                                                            <li id="{{$index}}"
                                                                class="list-group-item d-flex justify-content-between align-items-center"
                                                                [ngClass]="checkFilterIsActive(filter.key)"
                                                                (click)="applyFilter('trackingSystem',filter.key, dataSourceSymbiontsRecords,'symbiontsTab')"
                                                                style="cursor: pointer; padding: .75rem 0.25rem;"
                                                            >
                                                                {{ filter.key }}
                                                                <span class="badge badge-pill badge-info">{{ filter.doc_count }}</span>
                                                            </li>
                                                        }
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    }

                                </div>
                                <div class="table-container">
                                    <table mat-table [dataSource]="dataSourceSymbiontsRecords" matSort
                                           #relatedSymbiontsSort="matSort">
                                        <ng-container matColumnDef="accession">
                                            <th mat-header-cell *matHeaderCellDef> BioSample ID</th>
                                            <td mat-cell *matCellDef="let row"><a
                                                    href="https://www.ebi.ac.uk/biosamples/samples/{{row.accession}}">
                                                {{ row.accession }}</a></td>
                                        </ng-container>
                                        <ng-container matColumnDef="organism">
                                            <th mat-header-cell *matHeaderCellDef> Organism</th>
                                            <td mat-cell *matCellDef="let row"> {{ row.organism.text }}</td>
                                        </ng-container>
                                        <ng-container matColumnDef="commonName">
                                            <th mat-header-cell *matHeaderCellDef> Common Name</th>
                                            <td mat-cell *matCellDef="let row"> {{ row?.commonName }}</td>
                                        </ng-container>
                                        <ng-container matColumnDef="sex">
                                            <th mat-header-cell *matHeaderCellDef> Sex</th>
                                            <td mat-cell *matCellDef="let row"> {{ row?.sex }}</td>
                                        </ng-container>
                                        <ng-container matColumnDef="organismPart">
                                            <th mat-header-cell *matHeaderCellDef> Organism part</th>
                                            <td mat-cell *matCellDef="let row"> {{ row?.organismPart }}</td>
                                        </ng-container>
                                        <ng-container matColumnDef="trackingSystem">
                                            <th mat-header-cell *matHeaderCellDef> Tracking status</th>
                                            <td mat-cell *matCellDef="let row">
                                                <mat-chip
                                                        [ngStyle]="{'background-color': 'gold'}">{{ row.trackingSystem }}
                                                </mat-chip>
                                            </td>
                                        </ng-container>
                                        <tr mat-header-row *matHeaderRowDef="specDisplayedColumns"></tr>
                                        <tr mat-row *matRowDef="let row; columns: specDisplayedColumns;"></tr>
                                    </table>
                                </div>
                                <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"
                                               aria-label="Select page of symbionts"
                                               #relatedSymbiontsPaginator
                                               [length]="specSymbiontsTotalCount"></mat-paginator>
                            </div>
                        }
                        @if (dataSourceSymbiontsAssembliesCount != 0) {
                            <div>
                                <hr>
                                <h1 class="page-header">Related assemblies</h1>
                                <div class="table-container">
                                    <table mat-table [dataSource]="dataSourceSymbiontsAssemblies" matSort
                                           #assembliesSymbiontsSort="matSort">
                                        <ng-container matColumnDef="accession">
                                            <th mat-header-cell *matHeaderCellDef> Accession</th>
                                            <td mat-cell *matCellDef="let row">
                                                <a class="no-underline" target="_blank"
                                                   href="https://www.ebi.ac.uk/ena/browser/view/{{row.accession}}">{{ row.accession }}</a>
                                            </td>
                                        </ng-container>
                                        <ng-container matColumnDef="assembly_name">
                                            <th mat-header-cell *matHeaderCellDef> Assembly Name</th>
                                            <td mat-cell *matCellDef="let row">
                                                {{ row.assembly_name }}
                                            </td>
                                        </ng-container>
                                        <ng-container matColumnDef="description">
                                            <th mat-header-cell *matHeaderCellDef> Description</th>
                                            <td mat-cell *matCellDef="let row">
                                                {{ row.description }}
                                            </td>
                                        </ng-container>
                                        <ng-container matColumnDef="version"
                                                      class="column-width">
                                            <th mat-header-cell *matHeaderCellDef class="column-width">
                                                Version
                                            </th>
                                            <td mat-cell *matCellDef="let row">
                                                {{ row.version }}
                                            </td>
                                        </ng-container>
                                        <tr mat-header-row *matHeaderRowDef="displayedColumnsAssemblies"></tr>
                                        <tr mat-row *matRowDef="let row; columns: displayedColumnsAssemblies;"></tr>
                                    </table>
                                </div>
                                <mat-paginator #assembliesSymbiontsPaginator [pageSizeOptions]="[5,10, 20, 30]"
                                               showFirstLastButtons [length]="dataSourceSymbiontsAssembliesCount"
                                               style="width: 100%;"></mat-paginator>
                            </div>
                        }
                        <hr>
                    </mat-tab>
                }
                @if (organismData?.metagenomes_records && organismData?.metagenomes_records.length) {
                    <mat-tab label="Metagenomes"
                             class=tab-width>
                        @if (organismData?.metagenomes_records.length) {
                            <hr>
                            <h1 class="page-header">Related Metagenomes </h1>
                            <div class="col-sm-2">


                                @if(metagenomesSexFilters && metagenomesSexFilters.length > 0 ){
                                    <div class="row">
                                        <div class="col-md-12 col-sm-6">
                                            <div  class="card bg-lite mb-3 filter-top">
                                                <h3 class="card-header filter-heading">
                                                    <span >Sex</span>
                                                    @if(metagenomesSexFilters.length > 3){
                                                        <mat-icon
                                                                (click)="toggleFilter('metagenomeTab', 'sex')"
                                                                style="cursor: pointer; margin-left: auto;">
                                                            {{ showAllFilters['metagenomesTab']['sex'] ? 'add' : 'remove' }}
                                                        </mat-icon>
                                                    }
                                                </h3>


                                                <ul class="list-group">
                                                    @for (filter of (showAllFilters['metagenomesTab']['sex'] ? metagenomesSexFilters : metagenomesSexFilters.slice(0, 3)); track $index ) {
                                                        @if (filter.key != '') {
                                                            <li id="{{$index}}"
                                                                class="list-group-item d-flex justify-content-between align-items-center"
                                                                [ngClass]="checkFilterIsActive(filter.key)"
                                                                (click)="applyFilter('sex',filter.key, dataSourceSymbiontsRecords,'metagenomesTab')"
                                                                style="cursor: pointer; padding: .75rem 0.25rem;"
                                                            >
                                                                {{ filter.key }}
                                                                <span class="badge badge-pill badge-info">{{ filter.doc_count }}</span>
                                                            </li>
                                                        }
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                }
                                @if(metagenomesOrganismPartFilters && metagenomesOrganismPartFilters.length > 0 ){
                                    <div class="row">
                                        <div class="col-md-12 col-sm-6">
                                            <div  class="card bg-lite mb-3 filter-top">
                                                <h3 class="card-header filter-heading">
                                                    <span >Organism Part</span>
                                                    @if(metagenomesOrganismPartFilters.length > 3){
                                                        <mat-icon
                                                                (click)="toggleFilter('metagenomeTab','organismPart')"
                                                                style="cursor: pointer; margin-left: auto;">
                                                            {{ showAllFilters['metagenomesTab']['organismPart']? 'add' : 'remove' }}
                                                        </mat-icon>
                                                    }
                                                </h3>

                                                <ul class="list-group">
                                                    @for (filter of (showAllFilters['metagenomesTab']['sex'] ? metagenomesOrganismPartFilters : metagenomesOrganismPartFilters.slice(0, 3)); track $index ) {
                                                        @if (filter.key != '') {
                                                            <li id="{{$index}}"
                                                                class="list-group-item d-flex justify-content-between align-items-center"
                                                                [ngClass]="checkFilterIsActive(filter.key)"
                                                                (click)="applyFilter('trackingSystem',filter.key,dataSourceMetagenomesRecords ,'metagenomesTab')"
                                                                style="cursor: pointer; padding: .75rem 0.25rem;"
                                                            >
                                                                {{ filter.key }}
                                                                <span class="badge badge-pill badge-info">{{ filter.doc_count }}</span>
                                                            </li>
                                                        }
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                }
                                @if(metagenomesTrackingSystemFilters && metagenomesTrackingSystemFilters.length){
                                    <div class="row">
                                        <div class="col-md-12 col-md-6" >
                                            <div class="card bg-lite mb-3 filter-top">
                                                <h3 class="card-header filter-heading">
                                                    <span >Tracking Status</span>

                                                    @if (metagenomesTrackingSystemFilters.length > 3) {
                                                        <i class="material-icons float-right pointer-cursor"
                                                           (click)="toggleFilter('metagenomesTab',
                                                               'trackingSystem')">
                                                            {{ showAllFilters['metagenomesTab']['trackingSystem'] ? 'remove' : 'add' }}
                                                        </i>
                                                    }
                                                </h3>

                                                <ul class="list-group">
                                                    @for (filter of (showAllFilters['metagenomesTab']['sex'] ? metagenomesTrackingSystemFilters : metagenomesTrackingSystemFilters.slice(0, 3)); track $index ) {
                                                        @if (filter.key != '') {
                                                            <li id="{{$index}}"
                                                                class="list-group-item d-flex justify-content-between align-items-center"
                                                                [ngClass]="checkFilterIsActive(filter.key)"
                                                                (click)="applyFilter('trackingSystem',filter.key, dataSourceSymbiontsRecords,'metagenomesTab')"
                                                                style="cursor: pointer; padding: .75rem 0.25rem;"
                                                            >
                                                                {{ filter.key }}
                                                                <span class="badge badge-pill badge-info">{{ filter.doc_count }}</span>
                                                            </li>
                                                        }
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                }

                            </div>
                            <table mat-table [dataSource]="dataSourceMetagenomesRecords" matSort
                                   #metagenomesRecordsSort="matSort">
                                <ng-container matColumnDef="accession">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> BioSample ID</th>
                                    <td mat-cell *matCellDef="let row">
                                        <a href="https://www.ebi.ac.uk/biosamples/samples/{{row.accession}}">
                                            {{ row.accession }}</a>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="organism">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Organism</th>
                                    <td mat-cell *matCellDef="let row">
                                        {{ row.organism.text }}
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="commonName">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Common Name</th>
                                    <td mat-cell *matCellDef="let row">
                                        {{ row?.commonName }}
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="sex">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Sex</th>
                                    <td mat-cell *matCellDef="let row">
                                        {{ row?.sex }}
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="organismPart">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Organism part</th>
                                    <td mat-cell *matCellDef="let row">
                                        {{ row?.organismPart }}
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="trackingSystem"
                                              class="column-width">
                                    <th mat-header-cell *matHeaderCellDef
                                        mat-sort-header class="column-width"> Tracking status
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-chip
                                                style="background-color: yellow; color: black">{{ row.trackingSystem }}
                                        </mat-chip>
                                    </td>
                                </ng-container>
                                <tr mat-header-row *matHeaderRowDef="specDisplayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: specDisplayedColumns;"></tr>
                            </table>
                            <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page of metagenomes"
                                           #metagenomesRecordsPaginator
                                           [length]="metagenomesRecordsTotalCount" style="width: 100%;"></mat-paginator>
                        }
                        @if (dataSourceMetagenomesAssembliesCount !=
                        0) {
                            <ng-container style=" display: flex;">
                                <hr>
                                <h1 class="page-header">Related assemblies</h1>
                                <table mat-table [dataSource]="dataSourceMetagenomesAssemblies" matSort
                                       #assembliesMetagenomesSort="matSort"
                                >
                                    <ng-container matColumnDef="accession">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Accession</th>
                                        <td mat-cell *matCellDef="let row">
                                            <a class="no-underline" target="_blank"
                                               href="https://www.ebi.ac.uk/ena/browser/view/{{row.accession}}">{{ row.accession }}</a>
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="assembly_name">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Assembly Name</th>
                                        <td mat-cell *matCellDef="let row">{{ row.assembly_name }}
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="description">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Description</th>
                                        <td mat-cell *matCellDef="let row">{{ row.description }}
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="version"
                                                  class="column-width">
                                        <th mat-header-cell *matHeaderCellDef
                                            mat-sort-header class="column-width"> Version
                                        </th>
                                        <td mat-cell *matCellDef="let row">{{ row.version }}
                                        </td>
                                    </ng-container>
                                    <tr mat-header-row *matHeaderRowDef="displayedColumnsAssemblies"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumnsAssemblies;"></tr>
                                </table>
                                <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"
                                               aria-label="Select page of metagenomes assemblies"
                                               #assembliesMetagenomesPaginator
                                               [length]="dataSourceMetagenomesAssembliesCount"></mat-paginator>
                            </ng-container>
                        }
                        <hr>
                    </mat-tab>
                }
            </mat-tab-group>
        </div>
        <div></div>
    </div>

</div>
